window.__jivoOnError=function(e){if(-1===navigator.userAgent.search(/google/gi)&&-1===navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi))try{var t=jivo_config&&jivo_config.base_url,n="main";t&&(-1!==t.indexOf("jvs")&&(n="jvs"),-1!==t.indexOf("ru1")&&(n="ru1"),-1!==t.indexOf("ya")&&(n="ya"));var o=window.location.protocol+"//err.jivosite.com/widget",r="POST",i={widget:"true",widget_version:window.jivo_version,level:2,url:window.location.href,user_agent:navigator.userAgent,lineNumber:e&&e.lineNumber,fileName:e&&e.fileName,column:e&&e.columnNumber,full_message:e&&e.stack,short_message:e&&e.message,shard:n},a=new XMLHttpRequest;"withCredentials"in a?a.open(r,o,!0):"undefined"!=typeof XDomainRequest&&(a=new XDomainRequest).open(r,o),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(i))}catch(e){}},function(){window.__hasStorage=!1;try{localStorage.setItem("testLocalStorage","ok"),localStorage.removeItem("testLocalStorage"),window.__hasStorage=!0}catch(e){}function t(d,c,e,t){var i=d.console;if(i=i||{log:function(){},error:function(){}},d.WebSocket){if(void 0===d.jivo_magic_var){d.jivo_magic_var=!0;var r,l,u,n,a,g,s,f,m,v,p,h={hasStorage:d.__hasStorage,jivoLoaderVersion:e,loadScript:function(e,t){var n=t||c,o=n.getElementsByTagName("script")[0],r=n.createElement("script");ae(r),o.parentNode.insertBefore(r,o).src=e},currentLoaderVersionCache:t},o=navigator.userAgent.toLowerCase(),w=/iPhone|iPad|iPod|Android|Windows Phone/i.test(o),b=c.createElement("iframe"),_=c.createElement("div"),y=0,S=5,j=4,C=6048e5,I=0,E=0,T=[],L=!1,N=!1,O=G(),A=["AF","CG","CF","GW","ER","IR","IQ","KP","LR","LB","LY","ML","CU","SO","SD","SY","ZW","YE"],x=["127-129-12k-12i-12c-12h","12e-12i-12e-124-12c-12h","131-12e-12l-12m-124-12b-12c","124-12g-12o-129-12m-124-12g-12c-12h","127-124-12s-12c-12s","12g-124-12k-12c-12p-12n-124-12h-124","3n-12j-124-12d-12l","12g-129-12o-129-128-12k-12i-12h"];ue("Initialization"),d.__jivoBundleOnLoad=function(e){clearTimeout(a),g=e;var t=((new Date).getTime()-s)/1e3;6<t&&z("loadTime",t);z("bundleLoaded",!0),z("buildNumber",r.build_number),ue("Bundle is loaded"),function(){n=c.body.lastChild,_.style&&(_.style.opacity="0",_.style.visibility="hidden");_.setAttribute("id","jivo-iframe-container"),_.appendChild(b),n?n.parentNode.insertBefore(_,n.nextSibling):c.body.appendChild(_);P()}()},d.__jivoBundleInit=function(e){e.loaderContext=h,function(){g=null;var e=function(e){if(e){var t=e.querySelectorAll&&e.querySelectorAll(".js-jivo-bundle");return t&&0<t.length?t:e.getElementsByClassName("js-jivo-bundle")}}(ge());{if(!e)throw i.error("Cannot get bundle script element"),new Error("Cannot get bundle script element");for(var t=0;t<e.length;t++)e[t].parentNode&&(e[t].parentNode.removeChild(e[t]),e[t]=null);e=null}}()},d.jivo_init=function(){y=0;var e=c.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),d.dispatchEvent(e),J()},d.jivo_destroy=function(){y=0;var e=c.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),d.dispatchEvent(e),delete d.jivo_magic_var,setTimeout(function(){_.parentNode.removeChild(_)},10)},h.getHostURL=ce,h.loadConfig=q,h.store=O,h.setInStore=z;var H=!1,k=function(e){try{e.blockedURI&&-1!==e.blockedURI.indexOf("jivosite")&&(H=!0,c.removeEventListener("securitypolicyviolation",k))}catch(e){}}.bind(this);try{le(c,"securitypolicyviolation",k)}catch(e){}K(),function(){(O=G()).geoWidgetInfo.widgetId&&(m=O.geoWidgetInfo.widgetId,O=G(),f=O.configHost);z("isNewCode",N),h.store=O}();var B,R,W=null,M=!1;v&&(p=v.getAttribute("nonce")),m&&f?(ue("widgetId:",m,"configHost:",f),q(Y())):m&&f||(B="no_widget_id_or_confighost",R=5,Math.random()<=.01*R&&D(B),i.error("Failed to evaluate the widgetId or configHost"))}}else i.log("Not supported browser");function q(e,n){if(T.push(e),j<++E){ue("Config load limit is exceeded"),h.hasStorage&&localStorage.removeItem("jv_loader_info_"+m);var t=new Error("Config load limit is exceeded"),o="Config urls: "+T.join(";\r\n");try{t.stack=o}catch(e){t=new Error("Config load limit is exceeded. "+o)}d.__jivoOnError(t)}else if(ue("Loading config from",e),O.deletedInfo.widgetId&&O.deletedInfo.widgetId===m&&O.deletedInfo.resolveTime&&parseInt(O.deletedInfo.resolveTime)>=(new Date).getTime())i.error("This widget is permanently removed");else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var t=pe(se(r));t?(ue("Config is loaded",t),t.isDeleted?oe():n?(t.chat_mode=n.chat_mode,t.options=n.options,t.botmode=n.botmode,t.geoip=n.geoip,t.maintenance=!!n.maintenance,U(t,null)):function(r,i){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var e=pe(se(a));if(!e)throw new Error("Load widget status error");var t=a.getResponseHeader("X-BotMode"),n=a.getResponseHeader("X-GeoIP"),o=e.agents&&e.agents.length;ue("Status is loaded",e,t,n,o),r.botmode="yes"===t?"yes":null,r.geoip=n||";;;",r.chat_mode=o?"online":"offline",r.options=e.premium?888:0,e.bots&&e.bots.length&&(r.bots=e.bots),r.maintenance=!!e.maintenance,i(e.config_updated_ts)}else if(0!==a.status)throw r.botmode=null,r.geoip=";;;",r.chat_mode="offline",r.options=0,i(null),480==a.status&&ue("Site is under maintenance, try again later."),new Error("Load widget status error: "+a.status)};var e=Z()+"//"+r.comet.host+"/widget/status/"+r.site_id+"/"+r.widget_id+"?rnd="+Math.random();a.open("GET",e,!0),a.send(null)}(t,function(e){U(t,e)})):re()}else 0!==r.status&&re()},r.open("GET",e,!0),r.send(null)}}function D(e){if(0,-1===navigator.userAgent.search(/google/gi)&&-1===navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi))try{var t=Z()+"//telemetry.jivosite.com/w?cb=loader",n={event:e,widget_id:m,t:(new Date).getTime()};for(var o in n)t+="&"+o+"="+encodeURIComponent(n[o]);var r=new XMLHttpRequest;"withCredentials"in r?r.open("GET",t,!0):"undefined"!=typeof XDomainRequest&&(r=new XDomainRequest).open("GET",t),r.send()}catch(e){}}function U(e,t){if(e.isDeleted)oe();else{if(e.config_updated_ts&&e.config_updated_ts<t)return O.configUpdatedTs=t,q(Y(),e);if(f!==e.base_url&&!M)return ue("Wrong config host",f),f=e.base_url,void q(Y());if(e.regions&&!O.isChatStarted){var n=function(e){var t,n,o=e.regions,r=ne(e.geoip);if(o){for(var i=Object.keys(o),a=0;a<i.length;a++)for(var s=o[i[a]],d=0;d<s.length;d++)if(1!=s.length||"default"!==s[d]){var c=ne(s[d]);if(r.country===c.country){if(r.region===c.region)return te(i[a],s[d],e.geoip);n||c.region||(n=te(i[a],s[d],e.geoip))}}else t=i[a];if(n)return n;if(t)return te(t,"default",e.geoip)}}(e);if(n.widgetId!==m)return ue("Wrong geo-widget widgetId",m),z("geoWidgetInfo",n),m=n.widgetId,void q(Y())}if((W=e.ab_segment)&&W.name&&W.host&&W.staticHost&&1!==e.site_id)if(ue("AB-testing segmentation is enabled in config"),M=function(e,t){var n=O.abTesting,o=!1;o=n&&n.name===e.name?n.match:function(e,t){if(ue('Check for criteria match of test "'+e.name+'"'),e.device){if(!function(e){return"desktop"!==e?"mobile"!==e?"all"===e&&(me()||ve()):ve():me()&&!ve()}(e.device))return ue('Segment "'+e.name+'" is NOT matched. Criteria: device'),!1}if(e.locale){if(!function(e,t){return e===t.locale}(e.locale,t))return ue('Segment "'+e.name+'" is NOT matched. Criteria: locale'),!1}if(e.percentage){if(!function(e){return Math.random()<=.01*e}(e.percentage))return ue('Segment "'+e.name+'" is NOT matched. Criteria: percentage'),!1}return ue('Segment "'+e.name+'" is matched!'),!0}(e,t);return z("abTesting",{name:e.name,match:o}),o}(W,e)){ue("Ab-testing segment match! Segment:",W.name);var o="//"+W.host;ue('Setting new base_url. Was: "'+e.base_url+'". New: "'+o+'".'),e.base_url=o,ue('Setting new static_host. Was: "'+e.static_host+'". New: "'+W.staticHost+'".'),e.static_host=W.staticHost}else ue("Ab-testing segment is NOT matched");else z("abTesting",null),ue("AB-testing segmentation is NOT enabled in config"),z("configHost",f);!function(e){{if(z("log",!!e.logs),d.jivo_config=r=e,function(){if(r.host_blacklist)for(var e=r.host_blacklist.split(","),t=0;t<e.length;t++)if(0<=d.location.host.indexOf(e[t].replace(" ","")))return!0;return!1}())throw ue("Host is blacklisted",d.location.host),new Error("Placing widget is forbidden on "+d.top.location.host);if(function(){var e=r.geoip.split(";")[0];return 0<=A.indexOf(e)}())return i.log("[Jivo]: Service unavailable for country");if(!e.disable_stop_words&&function(){var e=!1,t=function(e){return e.map(function(e){return e.split("-").map(function(e){return String.fromCharCode(parseInt(e,32)-20)}).join("")})}(x),n=c.querySelector('meta[name="description"]'),o=c.querySelector('meta[name="keywords"]'),r=c.title,i=n&&n.content?n.content:"",a=o&&o.content?o.content:"";(de(r,t)||de(i,t)||de(a,t))&&(e=!0);return e}())return D("error_code_1015"),ue("Init error, code 1015.");if(w&&r.disable_mobile)return ue("Mobile widget is disabled")}{}r.static_host&&(~r.static_host.search(/\/\/cdn(-\w+)?.jivosite.com(\/\w)?/)||~r.static_host.search(/\/\/code(-\w+)?.jivosite.com(\/\w)?/))&&(L=!0);ue("isCdnProvider: ",L),"complete"==c.readyState?X():O.bundleLoaded&&O.buildNumber==r.build_number?"interactive"==c.readyState?X():le(d,"DOMContentLoaded",X):(z("bundleLoaded",!1),le(d,"load",X))}(e)}}function X(){ue("Widget initialization"),function(){ue("Iframe initialization"),b.src="javascript:void(0)",b.role="presentation",b.allow="autoplay",b.title="Jivochat",b.setAttribute("name","jivo_container"),b.setAttribute("id","jivo_container"),b.setAttribute("frameborder","no"),p&&b.setAttribute("nonce",p);d.atob&&"complete"!==c.readyState?le(d,"load",J):J();le(d,"message",function(e){if(e&&e.data&&"object"==typeof e.data){var t=e.data;"in_node_webkit"==t.name&&(d.jivo_cobrowse={source:e.source,origin:e.origin}),"iframe_url_changed"!=t.name&&"iframe_url_changed"!=t||P()}else r&&1===r.logs&&i&&i.log&&i.log("Error receive postMessage, window message event is empty.")})}()}function J(){var e=ce();ue("startLoadBundle",e),function(e){ue("Insertion of bundle code from",e);var t=ge(),n=c.createElement("script"),o=function(e){var t=r.bundle_folder?r.bundle_folder:"";return e+t+"/js/bundle_"+r.locale+".js?rand="+r.build_number}(e);s=(new Date).getTime(),ae(n),n.className="js-jivo-bundle",n.src=Z()+o,h.bundleSrc=o,n.onerror=function(){ue("loadBundle errorBundle",e),c.getElementById("jcont")&&function(e,t,n){if(clearTimeout(a),++I>=S){if(ue("Bundle load retries count is exceeded"),ue("Bad csp is: "+H),H)return i.error("Widget not loaded due CSP security policy.");var o=new Error("Bundle NOT loaded. Type: "+e+(t?". Host: "+t:"")+(n?". Status code: "+n:""));return d.__jivoOnError(o)}J()}("errorBundle",e)},t.appendChild(n)}(e)}function P(){if(!(3<y++)){if(!g)return y--,J();try{u=b.contentWindow.document}catch(e){l=c.domain,b.src="javascript:var d=document.open();d.domain='"+l+"';void(0);",u=b.contentWindow.document}var e='<meta name="google" content="notranslate"><meta http-equiv="X-UA-Compatible" content="IE=edge" />',t="window.onerror = function (message, url, lineNumber, columnNumber, error) {    if (error && error.error) {        error = error.error;    }    if (!error || !(error instanceof Error)) {        error = {};    }    error.stack = error.stack || 'empty';    error.message = 'Bundle init error: ' + message + ' error.message: ' + error.message;    error.columnNumber = columnNumber;    error.lineNumber = lineNumber;    error.url = url;    window.parent.__jivoOnError(error);};"+g,n=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),o=new RegExp("app(.)+jivosite.com","gi").test(d.location.host);if(n&&o||!u.head||!u.body){var r='<body class="notranslate"></body>',i='<script type="text/javascript"'+(p?'nonce="'+p+'"':"")+">"+t+"<\/script>",a="<head>"+e+i+"</head>";u.write("<!doctype HTML>"+a+r),a=r=i=null}else{u.body.class="notranslate",u.head.innerHTML=e;var s=c.createElement("script");s.type="text/javascript",p&&s.setAttribute("nonce",p),s.innerHTML=t,u.head.appendChild(s)}u.close(),t=null}}function G(){var e={isChatStarted:null,geoWidgetInfo:{widgetId:null,clientLocation:null,region:null},configHost:null,deletedInfo:{widgetId:null,resolveTime:null},abTesting:null,buildNumber:null,bundleLoaded:null,isNewCode:null,loadTime:null,log:null,configUpdatedTs:null};if(h.hasStorage&&(localStorage.removeItem("jv_loader_info"),m)){var t=pe(localStorage.getItem("jv_loader_info_"+m));t&&V(t,e)}return e}function z(e,t){if(O[e]=t,h.hasStorage&&m){var n={};V(O,n),localStorage.setItem("jv_loader_info_"+m,(o=n,d.MooTools&&void 0===JSON.stringify?JSON.encode(o):JSON.stringify(o)))}var o}function V(t,n){Object.keys(t).forEach(function(e){!function(e){if(F(e))return!0;if("object"==typeof e){for(var t=Object.keys(e),n=0;n<t.length;n++)if(!F(e[t[n]]))return!1;return!0}}(t[e])&&(n[e]=t[e])})}function F(e){return null===e&&"object"==typeof e}function Z(){var e=d.location&&d.location.protocol;return-1===["http","https"].indexOf(e||"")&&(e="https:"),e}function Y(){var e="";return O.configUpdatedTs&&(e="?v="+O.configUpdatedTs),Z()+f+"/script/widget/config/"+m+e}function K(){v=c.currentScript?c.currentScript:c.querySelector("script[jv-id]")||c.querySelector("script[data-jv-id]");var e,t=function(){if(v)return v.src;try{throw new Error("Get script URL")}catch(e){var t=e.stack;if(t){var n=Q(t),o=$(t),r=ee(t);return n?n[0]:o?o[0]:r?r[0]:null}}}(),n=Q(t),o=$(t),r=ee(t);f||(n?(f="//"+n[1],N=!0):o?f="//"+o[1]:r&&(f="//"+r[1])),m||(o&&o[2]?(m=o[2],N=!1):r&&r[2]?(m=r[2],N=!1):(N=!0,v&&(m=v.getAttribute("jv-id")||v.getAttribute("data-jv-id")),m||(e=t.match(/https?:\/\/\S+\/widget\/([A-Za-z0-9]+)/),m=e?e[1]:null)))}function Q(e){return e&&e.match(/https?:\/\/(\S+\.com)\/(widget\.js|widget\/[A-Za-z0-9]+)/)}function $(e){return e&&e.match(/https?:\/\/(\S+)\/script\/widget\/([A-Za-z0-9]+)/)}function ee(e){return e&&e.match(/https?:\/\/(\S+)\/script\/geo-widget\/([A-Za-z0-9]+)/)}function te(e,t,n){return{widgetId:e,region:t,clientLocation:n}}function ne(e){if("string"==typeof e&&""!==e){var t=e.split(";");return{country:t[0],region:t[1],city:t[2]}}}function oe(){ue("Widget was removed",m),z("configHost",null),O.geoWidgetInfo.widgetId||O.isChatStarted?(z("geoWidgetInfo",te(null,null,null)),z("isChatStarted",null),ie()):(z("deletedInfo",{widgetId:m,resolveTime:((new Date).getTime()+C).toString()}),i.error("Widget "+m+" is permanently removed. Host: "+f),D("widget_deleted"))}function re(){ue("Config loading error"),z("geoWidgetInfo",te(null,null,null)),z("isChatStarted",null),z("configHost",null),ie()}function ie(){f=m=null,K(),q(Y())}function ae(e){if(e)return e.type="text/javascript",e.async=!0,e.charset="UTF-8",p&&e.setAttribute("nonce",p),e}function se(e){return e.responseType&&"text"!==e.responseType?"document"===e.responseType?e.responseXML:e.response:e.responseText}function de(e,t){for(var n=!1,o=0;o<t.length;o++){var r=t[o].toLowerCase(),i=new RegExp("([, .]|^)"+r+"([, .]|$)","gi");if(-1<e.toLowerCase().search(i)){n=!0;break}}return n}function ce(){return L?r.static_host:r.base_url}function le(e,t,n){var o;e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&(e.attachEvent("on"+t,(o=e,function(){n.call(o,d.event)})),e=null)}function ue(){if(O.log){var e=Array.prototype.slice.call(arguments||[]);e.unshift("Loader:"),i.log.apply(i,e)}}function ge(){var e=c.head||c.getElementsByTagName("head")[0];if(!e)throw i.error("Cannot get document head element"),new Error("Cannot get document head element");return e}function fe(e){return-1!==o.indexOf(e)}function me(){return fe("chrome")&&!fe("opr/")&&"Google Inc."===d.navigator.vendor}function ve(){return!fe("windows")&&fe("android")}function pe(e){try{return d.MooTools&&void 0===JSON.parse?JSON.decode(e):JSON.parse(e)}catch(e){return null}}}var n=t,e=null;if(window.__hasStorage){try{e=JSON.parse(localStorage.getItem("__jivoLoader"))}catch(e){e.message="Loader parse error",window.__jivoOnError(e)}e&&.1<e.version&&(n=new Function("window","document","broswerCacheLoaderVersion","currentLoaderVersionCache","("+e.code+")(window, document, broswerCacheLoaderVersion, currentLoaderVersionCache)"))}try{n(window,document,.1,e?e.version:.1)}catch(e){e.message=e.message?"Loader error. "+e.message:"Loader error",window.__jivoOnError(e),delete window.jivo_magic_var,(n=t)(window,document,.1,.1)}}();